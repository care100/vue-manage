webpackJsonp([8],{"0XFv":function(e,t){},"9GPY":function(e,t,n){var r={"./Dashboard":["pRQ6",4],"./Dashboard.vue":["pRQ6",4],"./Department":["pK06",3],"./Department.vue":["pK06",3],"./Login":["qzG6"],"./Login.vue":["qzG6"],"./Role":["6o1n",2],"./Role.vue":["6o1n",2],"./User":["EDqK",1],"./User.vue":["EDqK",1],"./UserCenter":["anhd",0],"./UserCenter.vue":["anhd",0]};function a(e){var t=r[e];return t?Promise.all(t.slice(1).map(n.e)).then(function(){return n(t[0])}):Promise.reject(new Error("Cannot find module '"+e+"'."))}a.keys=function(){return Object.keys(r)},a.id="9GPY",e.exports=a},DZhg:function(e,t){},GULm:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});n("0XFv");var r=n("4P48"),a=n.n(r),s=n("7+uW"),o=n("//Fk"),i=n.n(o),u=n("9rMa"),l=n("Xxa5"),c=n.n(l),m=n("exGp"),d=n.n(m),p=n("bOdI"),f=n.n(p),h=n("Y0Uy"),v=n.n(h),b=[{label:"dashboard"},{label:"system",children:[{label:"department"},{label:"role"}]},{label:"user"}],g={login:"登录",index:"首页",dashboard:"控制台",system:"系统管理",department:"部门管理",role:"角色管理",user:"用户管理"},w=n("/ocq"),k=n("qzG6");s.a.use(w.a);var x,y=new w.a({mode:"history",routes:[{path:"/login",name:"login",component:k.default,meta:{skipAuth:!0}}]}),P={namespaced:!0,state:{token:localStorage.getItem("token"),username:localStorage.getItem("username"),loggedIn:!1,userInfo:null,menu:[]},getters:{username:function(e){return e.username},menu:function(e){return e.menu}},mutations:(x={},f()(x,"SET_USERNAME",function(e,t){e.username=t,localStorage.setItem("username",t)}),f()(x,"SET_USER_TOKEN",function(e,t){e.token=t,localStorage.setItem("token",t)}),f()(x,"SET_USER_INFO",function(e,t){e.userInfo=t,e.loggedIn=!0,e.menu=v.a.compact(b.map(function(t){if(t.children){var n=v.a.compact(t.children.map(function(t){if(e.userInfo.permission.includes(t.label))return t}));return n.length>0?{label:t.label,children:n}:void 0}if(e.userInfo.permission.includes(t.label))return t}))}),f()(x,"LOGOUT",function(e){e.userInfo=null,e.loggedIn=!1,e.menu=[],e.token="",localStorage.removeItem("token"),e.username="",localStorage.removeItem("username"),y.push("/login")}),x),actions:{login:function(e,t){var n=this,r=e.commit,a=e.dispatch;return d()(c.a.mark(function e(){var o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.http.post("/users/login",t);case 3:if(0!==(o=e.sent).data.code){e.next=9;break}return r("SET_USER_TOKEN",o.data.data.token),e.abrupt("return",o);case 9:return a("logout"),e.abrupt("return",o);case 11:e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),a("logout"),e.abrupt("return",e.t0);case 17:case"end":return e.stop()}},e,n,[[0,13]])}))()},getUserInfo:function(e){var t=this,n=e.commit,r=e.dispatch,a=e.state;return d()(c.a.mark(function e(){var o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s.a.http.post("/users/info",{token:a.token});case 3:if(0!==(o=e.sent).data.code){e.next=10;break}return n("SET_USERNAME",o.data.data.username),n("SET_USER_INFO",o.data.data),e.abrupt("return",o);case 10:return r("logout"),e.abrupt("return",o);case 12:e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(0),r("logout"),e.abrupt("return",e.t0);case 18:case"end":return e.stop()}},e,t,[[0,14]])}))()},logout:function(e){(0,e.commit)("LOGOUT")}}};s.a.use(u.a);var E=new u.a.Store({strict:!1,modules:{user:P}}),S=n("aozt"),$=n.n(S).a.create({baseURL:"http://127.0.0.1:8888",headers:{token:E.state.user.token||"",username:E.state.user.username||""}});$.interceptors.request.use(function(e){return e},function(e){return i.a.reject(e)}),$.interceptors.response.use(function(e){return-2===e.data.code&&E.dispatch("user/logout"),e}),s.a.http=s.a.prototype.$http=$;var U={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var q=n("VU/8")({name:"App",data:function(){return{usernameLocal:"new username"}},computed:{},created:function(){},methods:{}},U,!1,function(e){n("DZhg")},null,null).exports,F=n("Dd8w"),I=n.n(F),C={name:"HeadBar",data:function(){return{title:"Gateway",dialogVisible:!1,form:{oldPass:"",newPass:"",newPassSure:""},rules:{oldPass:[{required:!0,message:"必填"},{min:6,max:20,message:"6~20个字符"}],newPass:[{required:!0,message:"必填"},{min:6,max:20,message:"6~20个字符"}],newPassSure:[{required:!0,message:"必填"},{min:6,max:20,message:"6~20个字符"},{validator:this.equalNew,message:"新密码不一致"}]}}},computed:I()({},Object(u.c)("user",["username"])),methods:I()({},Object(u.b)("user",["logout"]),{equalNew:function(e,t,n){this.form.newPass===this.form.newPassSure?n():n(new Error(e.message))},validateEqual:function(){this.form.newPassSure&&this.$refs.passForm.validateField("newPassSure")},handleCommand:function(e){"userCenter"===e?this.$router.push("/admin/userCenter"):this.showDialog()},showDialog:function(){this.dialogVisible=!0},submit:function(){var e=this;this.$refs.passForm.validate(function(t){t&&(e.dialogVisible=!1)})},cancel:function(){this.dialogVisible=!1,this.$refs.passForm.resetFields()}})},R={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"head-bar"},[n("h1",[e._v(e._s(e.title))]),e._v(" "),n("el-dropdown",{on:{command:e.handleCommand}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n      "+e._s(e.username)+"\n      "),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"userCenter"}},[e._v("用户中心")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"showDialog"}},[e._v("修改密码")])],1)],1),e._v(" "),n("el-button",{attrs:{size:"mini"},on:{click:e.logout}},[e._v("Logout")]),e._v(" "),n("el-dialog",{attrs:{visible:e.dialogVisible,width:"500px",title:"修改密码"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.cancel}},[n("el-form",{ref:"passForm",attrs:{model:e.form,inline:!0,rules:e.rules,"label-width":"120px"}},[n("el-form-item",{attrs:{label:"原密码",prop:"oldPass"}},[n("el-input",{attrs:{placeholder:"请输入原密码",type:"password"},model:{value:e.form.oldPass,callback:function(t){e.$set(e.form,"oldPass",t)},expression:"form.oldPass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"新密码",prop:"newPass"}},[n("el-input",{attrs:{placeholder:"请输入新密码",type:"password"},on:{input:e.validateEqual},model:{value:e.form.newPass,callback:function(t){e.$set(e.form,"newPass",t)},expression:"form.newPass"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"确认新密码",prop:"newPassSure"}},[n("el-input",{attrs:{placeholder:"请再次输入新密码",type:"password"},model:{value:e.form.newPassSure,callback:function(t){e.$set(e.form,"newPassSure",t)},expression:"form.newPassSure"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)},staticRenderFns:[]};var O=n("VU/8")(C,R,!1,function(e){n("GULm")},"data-v-1a24789c",null).exports,D={name:"SideBar",data:function(){return{titles:g}},computed:I()({},Object(u.c)("user",["menu"])),methods:{go:function(e){this.$router.push(e)}}},G={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-menu",{staticClass:"side-bar",attrs:{mode:"vertical"}},[e._l(e.menu,function(t,r){return[t.children?n("el-submenu",{key:r,attrs:{index:"/admin/"+t.label}},[n("template",{slot:"title"},[n("span",[e._v(e._s(e.titles[t.label]))])]),e._v(" "),e._l(t.children,function(t,r){return n("el-menu-item",{key:r,attrs:{index:"/admin/"+t.label},on:{click:function(n){e.go("/admin/"+t.label)}}},[e._v("\n        "+e._s(e.titles[t.label])+"\n        ")])})],2):n("el-menu-item",{key:r,attrs:{index:"/admin/"+t.label},on:{click:function(n){e.go("/admin/"+t.label)}}},[e._v("\n      "+e._s(e.titles[t.label])+"\n      ")])]})],2)},staticRenderFns:[]};var L={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"foot-bar"},[this._v("Footer")])},staticRenderFns:[]};var V={name:"Layout",components:{HeadBar:O,SideBar:n("VU/8")(D,G,!1,function(e){n("b2My")},"data-v-6b0bb6a2",null).exports,FootBar:n("VU/8")(null,L,!1,function(e){n("jXXJ")},"data-v-898f14d6",null).exports}},j={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"layout"},[t("head-bar",{staticClass:"header"}),this._v(" "),t("side-bar",{staticClass:"aside"}),this._v(" "),t("router-view",{staticClass:"main-content"}),this._v(" "),t("foot-bar",{staticClass:"footer"})],1)},staticRenderFns:[]};var T,M=n("VU/8")(V,j,!1,function(e){n("uXtD")},"data-v-2b9e4007",null).exports,N=this;y.beforeEach((T=d()(c.a.mark(function e(t,r,a){var s,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.meta.skipAuth){e.next=21;break}if(!E.state.user.token){e.next=18;break}if(E.state.user.userInfo){e.next=15;break}return e.next=5,E.dispatch("user/getUserInfo");case 5:if(0===e.sent.data.code){e.next=8;break}return e.abrupt("return");case 8:(s=E.state.user.userInfo.permission.map(function(e){return{path:e,name:e,component:function(){return n("9GPY")("./"+_.upperFirst(e))}}})).unshift({path:"",name:"index",component:function(){return n.e(6).then(n.bind(null,"42Hy"))}}),o=[{path:"/admin",component:M,children:s},{path:"/",redirect:"/admin"},{path:"/*",name:"notFound",component:function(){return n.e(5).then(n.bind(null,"YcJa"))}}],y.addRoutes(o),a(t.fullPath),e.next=16;break;case 15:a();case 16:e.next=19;break;case 18:a({path:"/login",query:{redirect:t.path}});case 19:e.next=22;break;case 21:a();case 22:case"end":return e.stop()}},e,N)})),function(e,t,n){return T.apply(this,arguments)})),y.afterEach(function(e,t){document.title=g[e.name]}),s.a.config.productionTip=!1,s.a.use(a.a),new s.a({el:"#app",router:y,store:E,components:{App:q},template:"<App/>"})},b2My:function(e,t){},iMmv:function(e,t){},jXXJ:function(e,t){},qzG6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("Xxa5"),a=n.n(r),s=n("exGp"),o=n.n(s),i=n("Dd8w"),u=n.n(i),l=n("9rMa"),c={name:"Login",data:function(){return{form:{username:"",password:"",remember:!1},rules:{username:[{required:!0,message:"required"}],password:[{required:!0,message:"required"}]}}},methods:u()({},Object(l.b)("user",["login"]),{submit:function(){var e,t=this;this.$refs.loginForm.validate((e=o()(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=11;break}return e.prev=1,e.next=4,t.login(t.form);case 4:0===e.sent.data.code?t.$route.query&&t.$route.query.redirect?t.$router.push(t.$route.query.redirect):t.$router.push("/admin"):t.$message.error("用户名或密码错误！"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t.$message.error("网络错误！");case 11:case"end":return e.stop()}},e,t,[[1,8]])})),function(t){return e.apply(this,arguments)}))}})},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-row",[n("el-col",{attrs:{span:6,offset:9}},[n("h1",[e._v("Gateway")]),e._v(" "),n("el-form",{ref:"loginForm",attrs:{model:e.form,rules:e.rules}},[n("el-form-item",{attrs:{label:"username",prop:"username"}},[n("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"password",prop:"password"}},[n("el-input",{attrs:{type:"password"},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("Login")])],1)],1)],1)],1)},staticRenderFns:[]};var d=n("VU/8")(c,m,!1,function(e){n("iMmv")},"data-v-3037fc4a",null);t.default=d.exports},uXtD:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.db1d7d997c325163a078.js.map